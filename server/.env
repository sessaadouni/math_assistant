# =============================================================================
# RAG Maths - Exemple de configuration (.env)
# =============================================================================

# ----- Chunking -----
MATH_CHUNK_SIZE=1000
MATH_CHUNK_OVERLAP=150

# ----- Chemins -----
MATH_PDF_PATH=./model/livre_2011.pdf
MATH_DB_DIR=./db/chroma_db_math_v3_1
MATH_COLLECTION_NAME=math_course_v3_1

# ----- Ollama (endpoints) -----
# Hôte local (par défaut)
OLLAMA_HOST=http://localhost:11434
# OU spécifiez explicitement un hôte cloud :
OLLAMA_CLOUD_HOST=http://localhost:11434
# OLLAMA_CLOUD_HOST=https://ollama.your-domain.tld
# Clé API si serveur nécessite auth (ex. Ollama Cloud)
# OLLAMA_API_KEY=xxxxx

# ----- Runtime -----
# local | cloud | hybrid   (hybrid = cloud si dispo, sinon local)
RUNTIME_MODE=hybrid

# ----- Modèles LLM primaires -----
# LLM principal côté local
MATH_LLM_LOCAL=qwen2.5:7b-math
# LLM principal côté cloud
MATH_LLM_CLOUD=deepseek-v3.1:671b-cloud

# ----- Rewriter (réécriture de requêtes) -----
# 1 = activé, 0 = désactivé
MATH_USE_REWRITER=1
# Modèle local (léger, sans raisonnement) pour rewriting
MATH_LLM_REWRITER_LOCAL=gemma3:4b
# Équivalent cloud pour rewriting (sans raisonnement)
MATH_LLM_REWRITER_CLOUD=glm-4.6:cloud

# ----- Embeddings -----
EMBED_PRIMARY_MODEL_NAME=bge-m3:latest
EMBED_ALT_MODEL_NAME=mxbai-embed-large:latest

# ----- Reranker -----
# 1 = active le reranking CrossEncoder (nécessite GPU/CPU cost)
MATH_USE_RERANKER=1
# Alias acceptés : "bge-reranker-v2-m3:latest" → mappé sur "BAAI/bge-reranker-v2-m3"
MATH_RERANKER_MODEL=bona/bge-reranker-v2-m3:latest

# ----- Retrieval mix -----
# 1 = combine BM25 + vector ; 0 = vector seul (si base dispo) ou BM25-only si embeddings KO
USE_BM25_WITH_VECTOR=1

# ----- Routeur — Seuils -----
ROUTER_RAG_FIRST=0.55
ROUTER_LLM_FIRST=0.35

# ----- Routeur — Poids (somme renormalisée automatiquement à 1.0) -----
# SIM   : similarité fuzzy entre question et documents
# STRUCT: bonus si les filtres (chapitre, bloc) concordent avec les docs
# KW    : petit boost si le texte ressemble à des maths (mots-clés/symboles)
# PIN   : boost si un contexte "épinglé" est actif (et petite synergie si on reste en RAG)
ROUTER_W_SIM=0.65
ROUTER_W_STRUCT=0.20
ROUTER_W_KW=0.075
ROUTER_W_PIN=0.075

# ----- Routeur — Pénalités si contexte faible -----
# Appliqué si RAG renvoie peu de hits (<3) OU si la similarité max < 0.25
ROUTER_WEAK_PENALTY=0.20
# Pénalité additionnelle si la question cible un chapitre/bloc précis mais que le contexte est faible
ROUTER_WEAK_PENALTY_FOCUS=0.10

# ----- Serveur FastAPI (si tu exposes une API) -----
SERVER_HOST=0.0.0.0
SERVER_PORT=8000
SERVER_RELOAD=true
